<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Controle - Relatórios Técnicos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" xintegrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoVBL5gI9kLmbG4WdKCRpI72DhH1ZA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" xintegrity="sha512-qZvrmS2ekKPF2mSznTQsxqPgnpkI4DNTlrdUmTzrDgektczlKNRRhy5X5AAOnx5S09ydFYWWNSfcEqDTTHgtNA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            font-size: 14px;
        }
        .header-info { display: grid; grid-template-columns: auto 1fr; gap: 4px 8px; align-items: center; }
        .header-info label { font-weight: 600; text-align: right; }
        .data-table { width: 100%; border-collapse: collapse; min-width: 600px; }
        .data-table th, .data-table td { border: 1px solid #d1d5db; padding: 6px 8px; text-align: center; vertical-align: middle; }
        .data-table th { background-color: #f3f4f6; font-weight: 600; }
        .data-table td.label-cell { text-align: left; font-weight: 500; background-color: #f9fafb; }
        .input-yellow { background-color: #fef9c3; width: 100%; text-align: center; border: 1px solid #fde047; border-radius: 4px; padding: 4px; }
        .input-yellow::placeholder { color: #a1a1aa; }
        .output-span { display: block; width: 100%; height: 100%; padding: 4px; min-height: 28px; border-radius: 4px; transition: background-color: 0.3s; }
        .output-blue { background-color: #e0f2fe; }
        .section-title { background-color: #dbeafe; color: #1e3a8a; font-weight: 700; text-align: center; padding: 8px; margin-top: 1rem; margin-bottom: 0.25rem; border-radius: 6px; }
        .unit-selector {
            padding: 2px 4px;
            font-size: 12px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background-color: white;
            margin-left: 8px;
        }
        .menu-button {
            background-image: linear-gradient(to right, #4f46e5 0%, #7c3aed 51%, #4f46e5 100%);
            transition: 0.5s;
            background-size: 200% auto;
            box-shadow: 0 4px 15px 0 rgba(79, 70, 229, 0.75);
        }
        .menu-button:hover {
            background-position: right center;
        }
        .menu-button:disabled {
            background-image: none;
            background-color: #9ca3af;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        #transformer-insulation-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            border: 2px solid #9ca3af;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 1rem;
        }
        @media (min-width: 768px) { #transformer-insulation-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (min-width: 1024px) { #transformer-insulation-grid { grid-template-columns: repeat(3, 1fr); } }

        .insulation-cell { border-bottom: 1px solid #d1d5db; }
        .insulation-cell:last-child { border-bottom: none; }
        
        @media (min-width: 1024px) {
            .insulation-cell { border-right: 1px solid #d1d5db; }
            .insulation-cell:nth-child(3n) { border-right: none; }
            .insulation-cell:nth-last-child(-n+3) { border-bottom: none; }
        }
        @media (min-width: 768px) and (max-width: 1023px) {
             .insulation-cell { border-right: 1px solid #d1d5db; }
             .insulation-cell:nth-child(2n) { border-right: none; }
             .insulation-cell:nth-last-child(-n+2) { border-bottom: none; }
        }

        .cell-title { background-color: #e5e7eb; font-weight: 600; padding: 6px; text-align: center; border-bottom: 1px solid #d1d5db; font-size: 12px; }
        .cell-content { padding: 8px; }
        .measurement-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; align-items: center; margin-bottom: 6px; }
        .measurement-item { text-align: center; }
        .measurement-item label { font-size: 11px; font-weight: 500; display: block; margin-bottom: 2px; }
        .measurement-item .input-group { display: flex; align-items: center; justify-content: center; }
        .measurement-item input { max-width: 70px; padding: 2px 4px; font-size: 13px; }
        .measurement-item span.unit { font-size: 12px; font-weight: 500; margin-left: 4px; }
        .correction-title { text-align: center; font-weight: 500; font-size: 12px; padding: 4px; background-color: #f9fafb; border-top: 1px solid #d1d5db; border-bottom: 1px solid #d1d5db; margin: 8px -8px; }
        .indices-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; }
        .index-item { text-align: center; }
        .index-item label { font-size: 12px; font-weight: 600; display: block; margin-bottom: 2px; }
        .index-item span { display: block; padding: 4px; border-radius: 4px; font-weight: 500; min-height: 28px; }
        .status-cell { padding: 6px; border-radius: 6px; text-align: center; font-weight: bold; color: white; font-size: 12px; min-height: 32px; display: flex; align-items: center; justify-content: center; width: 100%; }
        .report-page { border: 1px solid #ccc; padding: 2rem; max-width: 800px; aspect-ratio: 210 / 297; margin: 2rem auto; background: white; display: flex; flex-direction: column; }
        
        #notification-area {
            position: fixed; top: 20px; right: 20px; z-index: 1000;
            display: flex; flex-direction: column; gap: 10px;
        }
        .toast {
            padding: 1rem 1.5rem; border-radius: 0.5rem; color: white; font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); opacity: 0; transform: translateX(100%);
            transition: opacity 0.5s, transform 0.5s;
        }
        .toast.show { opacity: 1; transform: translateX(0); }
        .toast.success { background-color: #28a745; }
        .toast.error { background-color: #dc3545; }
        .toast.info { background-color: #17a2b8; }

        .spinner {
            display: inline-block; width: 20px; height: 20px;
            border: 3px solid rgba(255, 255, 255, .3); border-radius: 50%;
            border-top-color: #fff; animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .confirm-modal-overlay {
            position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.6);
            display: none; align-items: center; justify-content: center; z-index: 2000;
        }
        .confirm-modal-content {
            background-color: white; padding: 2rem; border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); max-width: 400px;
            width: 90%; text-align: center;
        }

        .pdf-page-render {
            width: 210mm; min-height: 297mm; padding: 15mm; margin: 0;
            display: flex; flex-direction: column; background: white;
            box-shadow: none; border: none;
        }
        .pdf-fix-colors .input-yellow {
            background-color: #fef9c3 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact;
        }
        .pdf-fix-colors .output-blue {
            background-color: #e0f2fe !important; -webkit-print-color-adjust: exact; print-color-adjust: exact;
        }

        #index-page { display: flex; flex-direction: column; }
        #index-page .index-title {
            font-size: 1.25rem; font-weight: 700; margin-top: 2rem;
            margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 1px solid #e5e7eb;
        }
        #index-page .index-list-item {
            display: flex; justify-content: space-between; align-items: baseline;
            font-size: 1rem; padding: 0.75rem 0.25rem;
        }
        #index-page #index-company-logo { height: 3.5rem; }
        #index-page #index-rep-logo1, #index-page #index-rep-logo2 { height: 2.25rem; }
        #index-page footer { margin-top: auto; padding-top: 2rem; }
    </style>
</head>
<body class="bg-gray-100">

    <div id="notification-area"></div>

    <div id="auth-screen">
        <div class="min-h-screen bg-gray-800 flex flex-col items-center justify-center p-4">
            <h1 class="text-4xl font-bold text-white mb-8">Relatórios Técnicos</h1>
            <div id="login-form-container" class="w-full max-w-sm">
                <div class="bg-gray-700 p-8 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-bold text-white text-center mb-6">Acessar Conta</h2>
                    <form id="login-form">
                        <div class="mb-4">
                            <label for="login-email" class="block text-indigo-300 mb-2">Email</label>
                            <input type="email" id="login-email" required class="w-full p-3 rounded-lg border-2 border-indigo-400 bg-gray-600 text-white focus:outline-none focus:border-indigo-200">
                        </div>
                        <div class="mb-6">
                            <label for="login-password" class="block text-indigo-300 mb-2">Senha</label>
                            <input type="password" id="login-password" required class="w-full p-3 rounded-lg border-2 border-indigo-400 bg-gray-600 text-white focus:outline-none focus:border-indigo-200">
                        </div>
                        <button type="submit" class="w-full menu-button text-white font-bold py-3 px-6 rounded-xl text-lg">Entrar</button>
                    </form>
                    <p class="text-center text-gray-400 mt-6">Não tem uma conta? <a href="#" id="show-register-link" class="text-indigo-300 hover:underline">Crie uma agora</a></p>
                </div>
            </div>
            <div id="register-form-container" class="w-full max-w-sm hidden">
                <div class="bg-gray-700 p-8 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-bold text-white text-center mb-6">Criar Nova Conta</h2>
                    <form id="register-form">
                        <div class="mb-4">
                            <label for="register-name" class="block text-indigo-300 mb-2">Nome Completo</label>
                            <input type="text" id="register-name" required class="w-full p-3 rounded-lg border-2 border-indigo-400 bg-gray-600 text-white focus:outline-none focus:border-indigo-200">
                        </div>
                        <div class="mb-4">
                            <label for="register-email" class="block text-indigo-300 mb-2">Email</label>
                            <input type="email" id="register-email" required class="w-full p-3 rounded-lg border-2 border-indigo-400 bg-gray-600 text-white focus:outline-none focus:border-indigo-200">
                        </div>
                        <div class="mb-6">
                            <label for="register-password" class="block text-indigo-300 mb-2">Senha</label>
                            <input type="password" id="register-password" required class="w-full p-3 rounded-lg border-2 border-indigo-400 bg-gray-600 text-white focus:outline-none focus:border-indigo-200">
                        </div>
                        <button type="submit" class="w-full menu-button text-white font-bold py-3 px-6 rounded-xl text-lg">Criar Conta</button>
                    </form>
                    <p class="text-center text-gray-400 mt-6">Já tem uma conta? <a href="#" id="show-login-link" class="text-indigo-300 hover:underline">Faça o login</a></p>
                </div>
            </div>
            <div id="pending-approval-container" class="w-full max-w-sm hidden">
                <div class="bg-gray-700 p-8 rounded-xl shadow-lg text-center">
                    <h2 class="text-2xl font-bold text-white mb-4">Aguardando Aprovação</h2>
                    <p class="text-indigo-300">Sua conta foi criada com sucesso e está aguardando a aprovação do administrador.</p>
                     <button id="pending-back-to-login" class="mt-6 bg-gray-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600 transition">Voltar para Login</button>
                </div>
            </div>
        </div>
    </div>

    <div id="main-app-wrapper" class="hidden">
        
        <div id="report-selection-screen" class="hidden">
            <div class="min-h-screen bg-gray-800 flex flex-col items-center justify-center p-4">
                <h1 class="text-4xl font-bold text-white mb-2">Painel de Controle</h1>
                <p id="user-display-name-selection" class="text-indigo-300 mb-8"></p>
                <h2 class="text-2xl font-bold text-white mb-8">Selecione o Tipo de Relatório</h2>
                <div class="w-full max-w-2xl grid grid-cols-1 md:grid-cols-2 gap-6 text-center">
                    <button id="megagem-report-btn" class="menu-button text-white font-bold py-8 px-6 rounded-xl text-2xl">RELATÓRIO TÉCNICO<br>(MEGAGEM)</button>
                    <button id="bordo-report-btn" class="menu-button text-white font-bold py-8 px-6 rounded-xl text-2xl">RELATÓRIO TÉCNICO<br>(BORDO)</button>
                </div>
                <div class="mt-12 text-center flex gap-4">
                     <button id="profile-btn-from-selection" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition">Meu Perfil</button>
                     <button id="logout-btn-from-selection" class="bg-red-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-red-700 transition">Sair</button>
                 </div>
            </div>
        </div>

        <div id="menu-screen" class="hidden">
            <div class="min-h-screen bg-gray-800 flex flex-col items-center justify-center p-4">
                <h1 class="text-4xl font-bold text-white mb-8">Relatório de Megagem</h1>
                <div class="mb-8 w-full max-w-sm">
                    <label for="company-select" class="block text-center text-lg text-indigo-300 mb-2">Selecione a Empresa</label>
                    <select id="company-select" class="w-full p-3 text-center rounded-lg border-2 border-indigo-400 bg-gray-700 text-white focus:outline-none focus:border-indigo-200"></select>
                </div>
                <div class="w-full max-w-4xl flex flex-col gap-6 text-center">
                    <button id="admin-panel-btn" class="menu-button bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-4 px-6 rounded-xl text-lg hidden">PAINEL ADMIN</button>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                        <button id="cover-btn" class="menu-button text-white font-bold py-4 px-6 rounded-xl text-lg">EDITAR CAPA</button>
                        <button id="index-btn" class="menu-button text-white font-bold py-4 px-6 rounded-xl text-lg">ÍNDICE / EXPORTAR</button>
                        <button id="saved-reports-btn" class="menu-button text-white font-bold py-4 px-6 rounded-xl text-lg">RELATÓRIOS SALVOS</button>
                        <button id="gen-btn" class="menu-button text-white font-bold py-4 px-6 rounded-xl text-lg">GERADOR</button>
                        <button id="transformer-btn" class="menu-button text-white font-bold py-4 px-6 rounded-xl text-lg">TRAFO X3</button>
                        <button id="motor-btn" class="menu-button text-white font-bold py-4 px-6 rounded-xl text-lg">MOTOR</button>
                    </div>
                </div>
                <div class="mt-12 text-center">
                    <button id="main-menu-back-to-selection-btn" class="bg-gray-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600 transition">Voltar para Seleção</button>
                </div>
            </div>
        </div>
        
        <div id="profile-screen" class="hidden bg-gray-100 min-h-screen p-4">
            <div class="container mx-auto max-w-lg">
                <h1 class="text-3xl font-bold text-center text-blue-800 mb-6">Meu Perfil</h1>
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <form id="profile-form">
                        <div class="mb-4">
                            <label for="profile-name" class="block text-sm font-medium text-gray-700">Nome Completo</label>
                            <input type="text" id="profile-name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div class="mb-6">
                            <label for="profile-email" class="block text-sm font-medium text-gray-700">Email</label>
                            <input type="email" id="profile-email" disabled class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 bg-gray-100 text-gray-500 cursor-not-allowed">
                        </div>
                        <div class="flex gap-4">
                            <button type="button" id="profile-back-to-selection-btn" class="w-full bg-gray-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-600 transition">Voltar</button>
                            <button type="submit" id="profile-save-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition">Salvar Alterações</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div id="admin-panel-screen" class="hidden bg-gray-100 min-h-screen p-4">
            <div class="container mx-auto">
                <h1 class="text-3xl font-bold text-center text-blue-800 mb-6">Painel de Administração</h1>
                <div class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4 text-yellow-600">Usuários Pendentes</h2>
                        <div id="pending-users-list" class="space-y-3 max-h-96 overflow-y-auto"></div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4 text-green-600">Usuários Ativos</h2>
                        <div id="active-users-list" class="space-y-3 max-h-96 overflow-y-auto"></div>
                    </div>
                </div>
                <div class="flex justify-center mt-8">
                    <button id="admin-back-to-menu-btn" class="bg-gray-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600 transition">Voltar</button>
                </div>
            </div>
        </div>

        <div id="cover-screen" class="hidden bg-gray-100 min-h-screen p-4">
            <!-- O HTML completo da tela de capa deve ser mantido aqui -->
        </div>

        <div id="index-screen" class="hidden bg-gray-100 min-h-screen p-4">
            <!-- O HTML completo da tela de índice deve ser mantido aqui -->
        </div>

        <div id="saved-reports-screen" class="hidden bg-gray-100 min-h-screen p-4">
            <!-- O HTML completo da tela de relatórios salvos deve ser mantido aqui -->
        </div>

        <div id="company-management-screen" class="hidden bg-gray-100 min-h-screen p-4">
            <!-- O HTML completo da tela de gerenciamento de empresas deve ser mantido aqui -->
        </div>

        <div id="generator-app-screen" class="hidden bg-gray-100 min-h-screen p-4">
            <!-- O HTML completo da tela do gerador deve ser mantido aqui -->
        </div>
        
        <div id="motor-app-screen" class="hidden bg-gray-100 min-h-screen p-4">
            <!-- O HTML completo da tela do motor deve ser mantido aqui -->
        </div>

        <div id="transformer-app-screen" class="hidden bg-gray-100 min-h-screen p-4">
            <!-- O HTML completo da tela do transformador deve ser mantido aqui -->
        </div>

        <div id="bordo-app-screen" class="hidden bg-gray-100 min-h-screen p-4">
            <div class="container mx-auto p-2 sm:p-4 md:p-6 bg-white shadow-lg my-4 sm:my-8">
                <header class="border-b-2 border-gray-200 pb-6 mb-6">
                    <h1 class="text-xl sm:text-2xl font-bold text-blue-800 text-center">Diário de Bordo</h1>
                </header>
                <div class="flex flex-col sm:flex-row flex-wrap gap-4 justify-center my-4">
                    <button id="bordo-back-to-selection-btn" class="bg-gray-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600 transition w-full sm:w-auto">Voltar</button>
                    <button id="bordo-clear-form-btn" class="bg-red-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-red-700 transition w-full sm:w-auto">Limpar</button>
                    <button id="bordo-save-report-btn" class="menu-button text-white font-bold py-2 px-6 rounded-lg transition w-full sm:w-auto">Salvar Diário de Bordo</button>
                </div>
                <form id="bordo-form" class="grid grid-cols-1 md:grid-cols-2 gap-6 p-4 bg-gray-50 rounded-lg border">
                    <div>
                        <label for="bordo-data" class="font-semibold block mb-1">Data:</label>
                        <input type="date" id="bordo-data" required class="input-yellow w-full !text-gray-800">
                    </div>
                    <div>
                        <label for="bordo-operador" class="font-semibold block mb-1">Operador:</label>
                        <input type="text" id="bordo-operador" required class="input-yellow w-full !text-gray-800" placeholder="Nome do operador">
                    </div>
                    <div>
                        <label for="bordo-veiculo" class="font-semibold block mb-1">Veículo/Embarcação:</label>
                        <input type="text" id="bordo-veiculo" required class="input-yellow w-full !text-gray-800" placeholder="Ex: Lancha X, Caminhão Y">
                    </div>
                    <div>
                        <label for="bordo-odometro" class="font-semibold block mb-1">Odômetro/Horímetro (Inicial):</label>
                        <input type="number" id="bordo-odometro" class="input-yellow w-full !text-gray-800">
                    </div>
                    <div class="md:col-span-2">
                        <label for="bordo-ocorrencias" class="font-semibold block mb-1">Ocorrências / Descrição dos Serviços:</label>
                        <textarea id="bordo-ocorrencias" rows="5" class="input-yellow w-full !text-gray-800" placeholder="Descreva as atividades, manutenções, problemas..."></textarea>
                    </div>
                </form>
            </div>
        </div>

        <div id="wip-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4 z-50"></div>
        <div id="pdf-loader-overlay" class="fixed inset-0 bg-gray-900 bg-opacity-80 hidden items-center justify-center text-center text-white p-8 z-[200]"></div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, collection, addDoc, query, where, getDocs, deleteDoc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // ... (O código completo do seu JavaScript será colado aqui)
</script>
</body>
</html>
